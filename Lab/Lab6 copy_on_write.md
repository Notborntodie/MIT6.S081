# Lab6

*  cow的整体思路如下

 ```mermaid
 graph TD;
 A[修改uvmcopy,让子进程的虚拟内存映射到父进程的物理内存,让两者的PTE的都不可写]--利用PTE的RSW位让发生页面错误时可以知道是由COW引起的-->B[父子进程如果尝试写内存发生页错误,修改usertrap,给该进程的错误页分配物理页,修改该页的PTE]
 
 ```

* **还需要解决物理页的引用问题**。由于现在一个物理页可能对应着多个虚拟页，所以不能随便释放，比如假如父进程结束，而子进程依然在运行，对应其物理页则不能释放物理页。现在需要给物理页添加一个引用数，同时修改内核的内存分配机制，每对该物理页建立一个映射就修改引用数，反之亦然，只有引用数为0，才释放该物理页。



